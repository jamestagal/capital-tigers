(function(){function t(){}function s(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1}function n(e){return function(){return this[e].apply(this,arguments)}}var e=t.prototype,o=this,i=o.EventEmitter;e.getListeners=function(e){var t,s,n=this._getEvents();if("object"==typeof e){s={};for(t in n)n.hasOwnProperty(t)&&e.test(t)&&(s[t]=n[t])}else s=n[e]||(n[e]=[]);return s},e.flattenListeners=function(e){var t,n=[];for(t=0;t<e.length;t+=1)n.push(e[t].listener);return n},e.getListenersAsObject=function(e){var t,n=this.getListeners(e);return n instanceof Array&&(t={},t[e]=n),t||n},e.addListener=function(e,t){var n,o=this.getListenersAsObject(e),i="object"==typeof t;for(n in o)o.hasOwnProperty(n)&&-1===s(o[n],t)&&o[n].push(i?t:{listener:t,once:!1});return this},e.on=n("addListener"),e.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},e.once=n("addOnceListener"),e.defineEvent=function(e){return this.getListeners(e),this},e.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},e.removeListener=function(e,t){var n,i,o=this.getListenersAsObject(e);for(n in o)o.hasOwnProperty(n)&&(i=s(o[n],t),-1!==i&&o[n].splice(i,1));return this},e.off=n("removeListener"),e.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},e.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},e.manipulateListeners=function(e,t,n){var s,o,i=e?this.removeListener:this.addListener,a=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(s=n.length;s--;)i.call(this,t,n[s]);else for(s in t)t.hasOwnProperty(s)&&(o=t[s])&&("function"==typeof o?i.call(this,s,o):a.call(this,s,o));return this},e.removeEvent=function(e){var t,s=typeof e,n=this._getEvents();if("string"===s)delete n[e];else if("object"===s)for(t in n)n.hasOwnProperty(t)&&e.test(t)&&delete n[t];else delete this._events;return this},e.removeAllListeners=n("removeEvent"),e.emitEvent=function(e,t){var n,s,i,a,o=this.getListenersAsObject(e);for(s in o)if(o.hasOwnProperty(s))for(i=o[s].length;i--;)n=o[s][i],n.once===!0&&this.removeListener(e,n.listener),a=n.listener.apply(this,t||[]),a===this._getOnceReturnValue()&&this.removeListener(e,n.listener);return this},e.trigger=n("emitEvent"),e.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},e.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},e._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},e._getEvents=function(){return this._events||(this._events={})},t.noConflict=function(){return o.EventEmitter=i,t},"function"==typeof define&&define.amd?define("eventEmitter/EventEmitter",[],function(){return t}):"object"==typeof module&&module.exports?module.exports=t:this.EventEmitter=t}).call(this),function(e){function i(t){var n=e.event;return n.target=n.target||n.srcElement||t,n}var n,o,t=document.documentElement,s=function(){};t.addEventListener?s=function(e,t,n){e.addEventListener(t,n,!1)}:t.attachEvent&&(s=function(e,t,n){e[t+n]=n.handleEvent?function(){var t=i(e);n.handleEvent.call(n,t)}:function(){var t=i(e);n.call(e,t)},e.attachEvent("on"+t,e[t+n])}),n=function(){},t.removeEventListener?n=function(e,t,n){e.removeEventListener(t,n,!1)}:t.detachEvent&&(n=function(e,t,n){e.detachEvent("on"+t,e[t+n]);try{delete e[t+n]}catch(s){e[t+n]=void 0}}),o={bind:s,unbind:n},"function"==typeof define&&define.amd?define("eventie/eventie",o):e.eventie=o}(this),function(e,t){"function"==typeof define&&define.amd?define(["eventEmitter/EventEmitter","eventie/eventie"],function(n,s){return t(e,n,s)}):"object"==typeof exports?module.exports=t(e,require("eventEmitter"),require("eventie")):e.imagesLoaded=t(e,e.EventEmitter,e.eventie)}(this,function(e,t,n){function c(e,t){for(var n in t)e[n]=t[n];return e}function d(e){return"[object Array]"===m.call(e)}function u(e){if(t=[],d(e))t=e;else if("number"==typeof e.length)for(var t,n=0,s=e.length;s>n;n++)t.push(e[n]);else t.push(e);return t}function s(e,t,n){if(!(this instanceof s))return new s(e,t);"string"==typeof e&&(e=document.querySelectorAll(e)),this.elements=u(e),this.options=c({},this.options),"function"==typeof t?n=t:c(this.options,t),n&&this.on("always",n),this.getImages(),i&&(this.jqDeferred=new i.Deferred);var o=this;setTimeout(function(){o.check()})}function a(e){this.img=e}function o(e){this.src=e,r[e]=this}var r,i=e.jQuery,l=e.console,h="undefined"!=typeof l,m=Object.prototype.toString;return s.prototype=new t,s.prototype.options={},s.prototype.getImages=function(){this.images=[];for(e=0,s=this.elements.length;s>e;e++){t=this.elements[e],"IMG"===t.nodeName&&this.addImage(t);for(var e,t,s,i,o=t.querySelectorAll("img"),n=0,a=o.length;a>n;n++)i=o[n],this.addImage(i)}},s.prototype.addImage=function(e){var t=new a(e);this.images.push(t)},s.prototype.check=function(){function i(e,s){return t.options.debug&&h&&l.log("confirm",e,s),t.progress(e),o++,o===n&&t.complete(),!0}var e,s,t=this,o=0,n=this.images.length;if(this.hasAnyBroken=!1,!n)return void this.complete();for(e=0;n>e;e++)s=this.images[e],s.on("confirm",i),s.check()},s.prototype.progress=function(e){this.hasAnyBroken=this.hasAnyBroken||!e.isLoaded;var t=this;setTimeout(function(){t.emit("progress",t,e),t.jqDeferred&&t.jqDeferred.notify&&t.jqDeferred.notify(t,e)})},s.prototype.complete=function(){var e,t=this.hasAnyBroken?"fail":"done";this.isComplete=!0,e=this,setTimeout(function(){if(e.emit(t,e),e.emit("always",e),e.jqDeferred){var n=e.hasAnyBroken?"reject":"resolve";e.jqDeferred[n](e)}})},i&&(i.fn.imagesLoaded=function(e,t){var n=new s(this,e,t);return n.jqDeferred.promise(i(this))}),a.prototype=new t,a.prototype.check=function(){var t,e=r[this.img.src]||new o(this.img.src);if(e.isConfirmed)return void this.confirm(e.isLoaded,"cached was confirmed");if(this.img.complete&&void 0!==this.img.naturalWidth)return void this.confirm(0!==this.img.naturalWidth,"naturalWidth");t=this,e.on("confirm",function(e,n){return t.confirm(e.isLoaded,n),!0}),e.check()},a.prototype.confirm=function(e,t){this.isLoaded=e,this.emit("confirm",this,t)},r={},o.prototype=new t,o.prototype.check=function(){if(!this.isChecked){var e=new Image;n.bind(e,"load",this),n.bind(e,"error",this),e.src=this.src,this.isChecked=!0}},o.prototype.handleEvent=function(e){var t="on"+e.type;this[t]&&this[t](e)},o.prototype.onload=function(e){this.confirm(!0,"onload"),this.unbindProxyEvents(e)},o.prototype.onerror=function(e){this.confirm(!1,"onerror"),this.unbindProxyEvents(e)},o.prototype.confirm=function(e,t){this.isConfirmed=!0,this.isLoaded=e,this.emit("confirm",this,t)},o.prototype.unbindProxyEvents=function(e){n.unbind(e.target,"load",this),n.unbind(e.target,"error",this)},s})